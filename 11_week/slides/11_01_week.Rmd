---
title: "Associations Among Quantitative Variables"
subtitle: "Scatterplots, correlation, and multivariate structure"
author: "Jared Edgerton"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, plsc498.css]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: ""
---


# Quiz on canvas

- Log on to the course website to take it.
- You have 10 minutes.
- It is open notes and web.
- Do not generate your answers with AI.

---

# Quick Recap

- Last time, we focused on **composition**:
  - parts-to-whole reasoning (denominators)
  - stacked vs side-by-side comparisons
  - nested proportions (conditioning with facets)

Today, we focus on **associations among quantitative variables**:

- scatterplots and paired data
- correlation intuition (Pearson vs rank-based)
- correlograms (many variables at once)
- avoiding overclaiming
- (brief) dimension reduction as projection + information loss

---

# Simulated data for today


```{r, message=FALSE, warning=FALSE}
library(ggplot2); library(dplyr); library(tidyr); library(forcats); library(scales)
set.seed(123)
df <- tibble(
  id = 1:1800,
  context = sample(
    c("Urban", "Suburban", "Rural"),
    size = 1800,
    replace = TRUE,
    prob = c(0.45, 0.35, 0.20)
  ),
  age = round(rnorm(1800, mean = 40, sd = 12))
) %>%  mutate(
    context = factor(context, levels = c("Urban", "Suburban", "Rural")),
    age = pmin(pmax(age, 18), 75),
    news = rbeta(1800, 2, 2) * 10 +
      case_when(context == "Urban" ~ 0.8, context == "Rural" ~ -0.7, TRUE ~ 0) + rnorm(1800, 0, 0.6),
    news = pmin(pmax(news, 0), 10)
  )
```

---

# Simulated data outcomes

```{r, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(
    knowledge = 40 + 4.2 * news + 0.35 * (age - 40) + rnorm(1800, 0, 8),
    knowledge = pmin(pmax(knowledge, 0), 100),
    trust = 4.4 + 0.02 * knowledge - 0.10 * news +
      case_when(context == "Rural" ~ 0.2, TRUE ~ 0) +
      rnorm(1800, 0, 0.6),
    trust = pmin(pmax(trust, 1), 7),
    support = 50 + 0.55 * knowledge - 0.40 * (age - 40) +
      case_when(context == "Rural" ~ -4, TRUE ~ 0) +
      rnorm(1800, 0, 10),
    support = pmin(pmax(support, 0), 100)
  )

```

---

# Simulated data tails

```{r, message=FALSE, warning=FALSE}
df <- df %>%
  mutate(
    donation = exp(news / 2) * 15 + rlnorm(1800, meanlog = 0, sdlog = 0.25),
    log_donation = log(donation),
    polarization = 12 + 2.2 * (news - 5)^2 + rnorm(1800, 0, 1.8),
    polarization = pmin(pmax(polarization, 0), 45),
    trust_t1 = pmin(pmax(trust + rnorm(1800, 0, 0.4), 1), 7),
    trust_t2 = pmin(pmax(
      trust_t1 +
        0.25 * (context == "Urban") - 0.20 * (context == "Rural") +
        rnorm(1800, 0, 0.35),
      1
    ), 7)
  ) %>%
  select(id, context, age, news, knowledge, trust, support, donation, log_donation,
         polarization, trust_t1, trust_t2)
```

---

# Inspect data

```{r, message=FALSE, warning=FALSE}
df %>% 
  slice(1:10)
```

---

# Scatterplots are arguments

A scatterplot is not a decoration. It's a claim about a relationship.

Before you plot, decide what you're trying to argue:

- **Direction:** do higher x values tend to come with higher y values?
- **Strength:** is the pattern consistent or noisy?
- **Form:** linear, curved, clustered, threshold-y?
- **Exceptions:** outliers, subgroups, different regimes?

Also: distinguish **mapping** vs **styling**.

- **Mapping:** `aes(color = context)` (data → appearance)
- **Styling:** `color = "black"` (fixed choice)

---

# Example: a basic scatterplot

We start with position (x and y). Add transparency to reduce overplotting.

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
ggplot(df, aes(x = news, y = knowledge)) +
  geom_point(alpha = 0.25, size = 1) +
  theme_classic() +
  labs(x = "News use (0–10)", y = "Political knowledge (0–100)",title = "News use and knowledge", subtitle = "Each point is one respondent") 
```

---

# Interpretation: what can we say?

This plot supports a cautious claim:

- People who report more news use **tend** to score higher on knowledge.
- The relationship is not perfect: there's substantial spread at each x value.

Common overclaims to avoid:

- “News use causes knowledge.”
- “This is a strong relationship.” (How do you know it's strong?)
- “Everyone behaves like the trend line.”

---

# Example: mapping a third variable (color)

Color can help you see subgroup structure—*if* it reveals separation.

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
ggplot(df, aes(x = news, y = knowledge, color = context)) +
  geom_point(alpha = 0.30, size = 1) +
  theme_classic() +
  theme(legend.position = "bottom") +
  labs(x = "News use (0–10)", y = "Political knowledge (0–100)", color = NULL, title = "Adding context as a mapping", subtitle = "Same x and y, but now we can see group structure")
```

---

# Pause and discuss with a neighbor

Look at the colored scatterplot.

**Prompt:**

- What does color make easier to see?
- What does it make harder to see?
- If you removed the legend, could you still interpret it?

---

# Example: small multiples (facets)

When color gets crowded, small multiples often win.

```{r, message=FALSE, warning=FALSE, fig.width=7.2, fig.height=3.6}
ggplot(df, aes(x = news, y = knowledge)) +
  geom_point(alpha = 0.25, size = 1) +
  facet_wrap(~ context, nrow = 1) +
  theme_classic() +
  labs(x = "News use (0–10)",y = "Political knowledge (0–100)", title = "Conditioning on context", subtitle = "Facets separate patterns without relying on a legend")
```

---

# Smoothers: useful summaries 

A smoother is a *layer* that makes an implicit model choice.

Why it can help:

- shows the average pattern when points are noisy
- highlights curvature you might miss

Why it can mislead:

- can look more “certain” than the data justify
- different smoothers tell different stories

---

# Example: scatterplot + smoother

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
ggplot(df, aes(x = knowledge, y = support)) +
  geom_point(alpha = 0.18, size = 1) +
  geom_smooth(se = FALSE) +
  theme_classic() +
  labs(x = "Political knowledge (0–100)", y = "Policy support (0–100)", title = "Support vs knowledge (with smoother)", subtitle = "Treat the smoother as a summary, not a mechanism")
```

---

# Correlation intuition (two flavors)

Correlation is a *summary statistic* for how tightly points fall around a pattern.

Two common choices:

- **Pearson correlation:** measures *linear* association  
- **Rank-based correlation (Spearman):** measures *monotonic* association (based on ranks)

Interpretation habit:

- Use correlation to **support** what you already see in the scatterplot.
- Don't use correlation to replace the scatterplot.

---

# Example: one outlier can dominate

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
set.seed(999)
demo <- tibble(x = rnorm(120, 0, 1), y = x + rnorm(120, 0, 0.6))
demo_with_outlier <- demo %>%
  bind_rows(tibble(x = 6, y = -6))
demo_plot <- bind_rows(demo %>% mutate(version = "No outlier"),
  demo_with_outlier %>% mutate(version = "With one outlier"))
ggplot(demo_plot, aes(x = x, y = y)) +
  geom_point(alpha = 0.8, size = 1.4) +
  facet_wrap(~ version, nrow = 1) +
  theme_classic() +
  labs(x = "x", y = "y", title = "Same pattern, different correlation story")
```

---

# What changed? (Pearson vs rank-based)

```{r, message=FALSE, warning=FALSE}
pearson_no <- cor(demo$x, demo$y, method = "pearson")
spearman_no <- cor(demo$x, demo$y, method = "spearman")
pearson_out <- cor(demo_with_outlier$x, demo_with_outlier$y, method = "pearson")
spearman_out <- cor(demo_with_outlier$x, demo_with_outlier$y, method = "spearman")
tibble(version = c("No outlier", "With one outlier"),
  pearson = c(pearson_no, pearson_out),
  spearman = c(spearman_no, spearman_out)
) %>%
  mutate(across(c(pearson, spearman), ~ round(.x, 2)))
```

---

# Example: monotonic but nonlinear

This relationship is clearly increasing, but it curves.

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
ggplot(df, aes(x = news, y = donation)) +
  geom_point(alpha = 0.18, size = 1) +
  theme_classic() +
  labs(x = "News use (0–10)", y = "Donations (simulated units)", title = "Monotonic but nonlinear", subtitle = "Pearson (linear) and Spearman (rank-based) summarize different things")
```

---

# Correlation numbers (and what they mean)

```{r, message=FALSE, warning=FALSE}
tibble(
  pearson = cor(df$news, df$donation, method = "pearson"),
  spearman = cor(df$news, df$donation, method = "spearman")
) %>%
  mutate(across(everything(), ~ round(.x, 2)))
```

---

# Correlation can miss real structure

If the relationship is *non-monotonic*, both correlations can be near zero.

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
ggplot(df, aes(x = news, y = polarization)) +
  geom_point(alpha = 0.18, size = 1) +
  theme_classic() +
  labs(x = "News use (0–10)", y = "Polarization (0–45)", title = "A strong pattern with low correlation", subtitle = "The structure is real, but correlation is the wrong summary")
```

---

# Data visualization critique

- Take five minutes
  - What relationship is the figure claiming?
  - Is the main comparison happening by **position** or by something less accurate?
  - Does the design help you assess *strength* vs *noise*?
  - What is one concrete improvement?

.center[
<img src="vientam_weather.png" style="width:70%;">
]

---

# Many variables: correlograms

When you have several quantitative variables, you often need:

- a *quick summary* of pairwise relationships
- a way to spot clusters (variables that move together)
- a place to decide what to explore next with scatterplots

A correlogram is a map of correlations.

---

# Example: correlation heatmap (Pearson)

```{r, message=FALSE, warning=FALSE}
cor_vars <- df %>%
  select(age, news, knowledge, trust, support, polarization, log_donation)
cor_mat <- cor(cor_vars, method = "pearson")
cor_df <- as.data.frame(cor_mat) %>%
  tibble::rownames_to_column(var = "var1") %>%
  pivot_longer(-var1, names_to = "var2", values_to = "r") %>%
  mutate(
    var1 = factor(var1, levels = colnames(cor_mat)),
    var2 = factor(var2, levels = colnames(cor_mat))
  )
```

```{r, message=FALSE, warning=FALSE, fig.width=7.2, fig.height=4.2, echo=FALSE}
ggplot(cor_df, aes(x = var2, y = var1, fill = r)) +
  geom_tile(color = "white", linewidth = 0.3) +
  scale_fill_gradient2(limits = c(-1, 1), labels = number_format(accuracy = 0.1)) +
  theme_classic() +
  theme(
    axis.title = element_blank(),
    axis.text.x = element_text(angle = 35, hjust = 1),
    legend.position = "bottom"
  ) +
  labs(
    fill = "Pearson r",
    title = "Correlogram (Pearson)",
    subtitle = "A compact summary—then go back to scatterplots for meaning"
  )
```

---

# Example: correlation heatmap (rank)

Rank-based correlation is often a better default when: (a) the relationship is monotonic but curved, (b) the data have outliers, and (c) you're using ordinal-ish measures.

```{r, message=FALSE, warning=FALSE}
cor_mat_s <- cor(cor_vars, method = "spearman")
cor_df_s <- as.data.frame(cor_mat_s) %>%
  tibble::rownames_to_column(var = "var1") %>%
  pivot_longer(-var1, names_to = "var2", values_to = "r") %>%
  mutate(
    var1 = factor(var1, levels = colnames(cor_mat_s)),
    var2 = factor(var2, levels = colnames(cor_mat_s)))
```

```{r, message=FALSE, warning=FALSE, fig.width=7.2, fig.height=4.2, echo=FALSE}
ggplot(cor_df_s, aes(x = var2, y = var1, fill = r)) +
  geom_tile(color = "white", linewidth = 0.3) +
  scale_fill_gradient2(limits = c(-1, 1), labels = number_format(accuracy = 0.1)) +
  theme_classic() +
  theme(axis.title = element_blank(),
        axis.text.x = element_text(angle = 35, hjust = 1),
    legend.position = "bottom"
  ) +
  labs(fill = "Spearman ρ", title = "Correlogram (rank-based)", subtitle = "Same idea, different definition of “association”")
```

---

# Paired data: the same units twice

Paired data are repeated measurements on the same people/units.

Questions paired plots help answer:

- Who changed the most?
- Did most change in the same direction?
- Are there stable “high” and “low” units?

---

# Example: paired scatterplot + identity line

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8}
ggplot(df, aes(x = trust_t1, y = trust_t2)) +
  geom_abline(slope = 1, intercept = 0, linewidth = 0.8, alpha = 0.5) +
  geom_point(alpha = 0.25, size = 1) +
  coord_equal(xlim = c(1, 7), ylim = c(1, 7)) +
  theme_classic() +
  labs(x = "Trust (time 1)", y = "Trust (time 2)", title = "Paired measurements", subtitle = "Points above the line increased; below the line decreased")
```

---

# Example: a slopegraph view (sampled)

```{r, message=FALSE, warning=FALSE}
set.seed(202)
ids_small <- df %>% sample_n(40) %>% pull(id)
df_long <- df %>%
  filter(id %in% ids_small) %>%
  select(id, context, trust_t1, trust_t2) %>%
  pivot_longer(cols = c(trust_t1, trust_t2), names_to = "time", values_to = "trust") %>%
  mutate(time = recode(time, trust_t1 = "Time 1", trust_t2 = "Time 2"), 
         time = factor(time, levels = c("Time 1", "Time 2")))
```

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8, echo=FALSE}
ggplot(df_long, aes(x = time, y = trust, group = id)) +
  geom_line(alpha = 0.35) +
  geom_point(size = 1.4, alpha = 0.7) +
  theme_classic() +
  labs(x = NULL, y = "Trust (1–7)", title = "Slopegraph (sample)", subtitle = "Good for seeing who moved—and how much")
```

---

# Data visualization critique

- Take five minutes
  - What is the “unit” of analysis (a person, a country, a school)?
  - Is the plot showing *paired* change or cross-sectional association?
  - Are you tempted to interpret it causally? Why?
  - What would a better comparison look like?

.center[
<img src="investment_rank.png" style="width:60%;">
]

---

# Dimension reduction (intuition only)

When you have lots of correlated variables:

- many columns overlap in the information they contain
- plots get cluttered quickly
- summaries like correlograms help, but they’re still pairwise

A dimension reduction technique creates **new axes** that are:

- combinations of the original variables
- designed to capture “as much information as possible” in fewer dimensions

Think: **projection + information loss**.

---

# Optional: PCA as a geometric summary

```{r, message=FALSE, warning=FALSE}
pca_df <- df %>%
  select(age, news, knowledge, trust, support, polarization, log_donation) %>%
  mutate(across(everything(), as.numeric))

pca_fit <- prcomp(pca_df, center = TRUE, scale. = TRUE)

pca_scores <- as_tibble(pca_fit$x[, 1:2]) %>%
  rename(PC1 = PC1, PC2 = PC2) %>%
  bind_cols(df %>% select(context))
```

```{r, message=FALSE, warning=FALSE, fig.width=6.6, fig.height=3.8, echo=FALSE}
ggplot(pca_scores, aes(x = PC1, y = PC2, color = context)) +
  geom_point(alpha = 0.25, size = 1) +
  theme_classic() +
  theme(legend.position = "bottom") +
  labs(
    x = "PC1 (a new axis)",
    y = "PC2 (a second new axis)",
    color = NULL,
    title = "A 2D projection of many variables",
    subtitle = "Useful as a map of similarity—but it discards information"
  )
```

---

# What success looks like

- You use scatterplots to describe:
  - direction, strength, form, and exceptions
- You can explain **mapping vs styling** in `ggplot2`
- You treat correlation as a *summary*, not a substitute for a plot
- You can choose Pearson vs rank-based correlation intentionally
- You can read correlograms as “where to look next,” not “final answers”
- You can recognize paired data and choose a paired visualization

---



# In-Class Activity

Find a visualization online.

With a neighbor:
- Identify the data variables
- Identify the visual mappings
- Decide what message the plot is making
- Suggest one concrete improvement


---

# What Comes Next

Next, we will move from “make a scatterplot” to an **interpretation-first workflow**:

- start with a question
- choose a minimal plot that answers it
- add layers only when they clarify the argument
- practice correlation heatmaps and small multiples
- (optional) treat PCA as a geometric summary, not a black box
